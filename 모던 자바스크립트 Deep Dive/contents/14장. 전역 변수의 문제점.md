# 14장: 전역 변수의 문제점 
> 무분별한 전역 변수 사용은 위험하다. 전역 변수를 사용해야 할 이유를 찾지 못했다면 지역 변수를 사용해야 한다

## 14-1. 변수의 생명 주기
- 변수는 생성되고 소멸되는 생명 주기(Life Cycle)이 있다 
- **호이스팅** 현상으로 인해 런타임 전 자바스크립트 엔진은 모든 변수의 선언문을 먼저 처리한다. 하지만 정확히 말하자면 이건 전역 변수에 한정된 설명이다 
- 함수 내부의 변수 선언문은 함수가 호출되고 난 후, 함수의 코드가 한줄씩 실행되기 전 (함수의 런타임 전) 실행된다 
```javascript 
function foo() {
    // 1. 함수 내부 코드 실행 전, 이 시점에서 변수 x 생성 (x = undefined)
    // 2. ▼ x 변수에 값 할당 
    var x = 'local variable'; 
    console.log(x); // --> 'local variable'
}
// 함수 종료 후 변수 x 소멸 
```
- ❗따라서 정확히 말하면 **호이스팅은 스코프를 단위로 동작한다** ❗
```javascript
var x = 'global';

function foo() {
    console.log(x); // --> undefined 
    var x = 'local';
}

foo(); 
console.log(x); // --> 'global' 
```
- 함수 호출 이후, 함수 몸체 내부 코드 실행이 완료되면 함수 내부에서 사용했던 변수는 소멸한다. 즉, **지역 변수의 생명 주기는 함수의 생명 주기와 일치한다** 
- 종종 지역 변수가 함수보다 오래 생존하는 경우도 있다 
- 함수에서 선언된 지역 변수는 함수가 생성한 스코프에 등록된다. 이 스코프는 렉시컬 환경이라 부르는 물리적인 실체가 있다. 따라서 변수는 자신이 등록된 스코프가 소멸(메모리 해제)될 때까지 유효하다. 즉, **어떠한 식별자가 해당 메모리 공간을 참조하고 있으면 해제되지 않고 확보된 상태로 남아있게 된다.** 이는 스코프도 마찬가지다. (클로저 참조)
- 이렇게 짧은 생명 주기를 가진 지역 변수와 달리 전역 변수는 (함수 호출 같은) 진입점이 없고, 코드가 로드되자마자 곧바로 해석되고 실행된다. 비슷한 맥락으로 (반환문 같이) 명확한 탈출점도 없기 때문에 생명 주기가 곧 전역 객체의 생명 주기와 일치한다 
- 💡브라우저 환경에서 전역 객체는 `window`이므로, 브라우저 환경의 전역 객체는 window의 프로퍼티다. window는 **웹페이지를 닫기 전까지 유효하다**. 즉, 브라우저 환경에서 전역 변수는 웹페이지 자체를 닫을 때까지 유효하다 

<br>

## 14-2. 전역 변수의 문제점 
### A. 암묵적 결합 
- 전역 변수를 사용하는 것은 암묵적 결합을 허용한다는 것이다. 이는 즉 코드 어디서든 해당 변수를 참조하고 변경될 수 있다는 것이다 
- 유효 범위가 넓을 수록 가독성이 나빠지고 상태가 변경될 수 있는 위험성이 높아진다 

### B. 긴 생명 주기
- 변수의 생명 주기가 길면 메모리 리소스도 오랜 기간 소비한다
- 또한, 전역 변수의 상태를 변경할 수 있는 시간도 길고 기회도 많아진다 

### C. 스코프 체인 상에서 종점에 존재
- 변수를 검색할 때 스코프 체인의 흐름에 따라 전역 변수는 가장 마지막에 검색된다. 즉, 검색 속도가 가장 느리다

### D. 네임스페이스 오염 
- 파일이 달라도 하나의 전역 스코프를 공유한다 
- 다른 파일 내에서 동일한 이름으로 명명된 전역 변수나 전역 함수가 같은 스코프 내에 존재할 경우 예상치 못한 결과를 가져올 수 있다 
