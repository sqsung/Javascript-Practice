# 42장: 비동기 프로그래밍

-   [42장: 비동기 프로그래밍](#42장-비동기-프로그래밍)
    -   [42-1. 동기 처리와 비동기 처리](#42-1-동기-처리와-비동기-처리)
    -   [42-2. 이벤트 루프와 태스크 큐](#42-2-이벤트-루프와-태스크-큐)
        -   [42-2-1. 이벤트 루프 (Event Loop)](#42-2-1-이벤트-루프-event-loop)
        -   [42-2-2. 태스크 큐 (Task Queue)](#42-2-2-태스크-큐-task-queue)
        -   [42-2-3. 추가](#42-2-3-추가)

## 42-1. 동기 처리와 비동기 처리

-   자바스크립트 엔진은 단 하나의 실행 컨텍스트 스택을 갖는다, 즉 한 번에 하나의 태스크만 실행할 수 있기 때문에 처리에 시간이 걸리는 태스크를 실행하는 경우 **블로킹**(작업 중단) 현상이 발생한다
-   예를 들어 `setTimeout` 메서드를 사용한 것처럼 일정 시간이 지난 후 명시된 콜백 함수가 호출되어야 하는 상황을 setTimeout 메서드 없이 구현한 경우, 타이머가 완료되고 콜백 함수가 호출될 때까지 자바스크립트 엔진은 다른 일을 할 수 없는 상태가 된다

```javascript
const timered = () => {
    console.log("Timered Function!");
    return;
};

const nonTimered = () => {
    console.log("Non-Timered Function!");
    return;
};

setTimeout(timered, 3000);
nonTimered();

// Non-Timered Function!
// --- 3초 대기 ---
// Timered Function!
```

-   물론 `setTimeout`으로 타이머를 구현한 경우에는 타이머가 동작하는 동안 다음 함수가 우선 실행된다 (즉, 비동기 처리된다)
-   **비동기 처리**란 현재 실행 중인 태스크가 종료되지 않는 상태라 해도 다음 태스크를 곧바로 실행하는 방식이라 볼 수 있다

<br>

## 42-2. 이벤트 루프와 태스크 큐

-   V8 자바스크립트 엔진 포함 대부분의 자바스크립트 엔진은 크게 2개의 영역으로 구분할 수 있다 → 콜스택(Call Stack) & 힙(Heap)
    -   콜스택: 실행 컨텍스트 스택
    -   힙: 객체가 저장되는 메모리 공간
-   콜스택과 힙으로 구성되어 있는 JS 엔진은 단순히 태스크가 요청되면 코 스택을 통해 요청된 작업을 순차적으로 실행할 뿐이다
-   비동기 처리에서 소스코드의 평가와 실행을 제외한 모든 처리는 브라우저 또는 Node.js가 담당하며, 이러한 처리를 위해 브라우저는 이벤트 루프와 태스크 큐를 제공하는 것이다

### 42-2-1. 이벤트 루프 (Event Loop)

-   **이벤트 루프**(Event Loop)는 브라우저에 내장되어 있는 기능 중 하나이며, 자바스크립트의 동시성을 지원하는 주요 기능이다
-   이벤트 루프는 콜 스택에 현재 실행 중인 실행 컨텍스트가 있는지, 그리고 태스크 큐에 대기 중인 함수(콜백 함수, 이벤트 핸들러 등)가 있는지 반복해서 확인한다
-   만약 콜스택이 비어 있고, 태스크 큐에 대기 중인 함수가 있다면 이벤트 루프는 순차적으로 태스크 큐에 대기 중인 함수를 콜 스택으로 이동시킨다

### 42-2-2. 태스크 큐 (Task Queue)

-   setTimeout이나 setInterval 같은 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역이다

### 42-2-3. 추가

-   비동기 함수인 setTimeout의 콜백 함수는 태스크 큐에 푸시되어 대기하다가 콜스택이 비게 되면 비로소 콜스택에 푸시되어 실행된다
-   자바스크립트는 싱글스레드로 동작하지만, 싱글스레드 방식으로 동작하는 건 브라우저가 아니라 브라우저에 내장된 JS 엔진이다
-   만약 모든 JS 코드가 싱글 스레드 방식으로 동작한다면 JS는 비동기 처리를 절대 할 수 없다
