# 11장: 자바스크립트와 상호 동작

- 11장의 다루는 주요 내용은 타입 선언 사용하기, 자바스크립트에서 타입스크립트로 점진적 마이그레이션하기, 서드 파티 자바스크립트와 타입스크립트 사용하기다

---

- [11장: 자바스크립트와 상호 동작](#11장-자바스크립트와-상호-동작)
  - [11-1. 타입 선언](#11-1-타입-선언)
    - [11-1-1. 앰비언트 변수 선언](#11-1-1-앰비언트-변수-선언)
    - [11-1-2. 앰비언트 타입 선언](#11-1-2-앰비언트-타입-선언)
  - [11-2. 자바스크립트를 타입스크립트로 천천히 마이그레이션 하기](#11-2-자바스크립트를-타입스크립트로-천천히-마이그레이션-하기)
    - [11-2-1. 단계 1: TSC 추가](#11-2-1-단계-1-tsc-추가)
    - [11-2-3. 단계 2: JSDoc 어노테이션 추가 (선택사항)](#11-2-3-단계-2-jsdoc-어노테이션-추가-선택사항)
    - [11-2-4. 단계 3: 파일 이름을 `.ts`로 바꾸기](#11-2-4-단계-3-파일-이름을-ts로-바꾸기)
    - [11-2-5. 단계 4: 엄격하게 만들기](#11-2-5-단계-4-엄격하게-만들기)
  - [11-4. 서드 파티 자바스크립트 사용](#11-4-서드-파티-자바스크립트-사용)
    - [11-4-1. 경우 1: 타입 선언을 포함하는 자바스크립트](#11-4-1-경우-1-타입-선언을-포함하는-자바스크립트)
    - [11-4-2. 경우 2: DefinitelyTyped에서 타입 선언을 제공하는 자바스크립트](#11-4-2-경우-2-definitelytyped에서-타입-선언을-제공하는-자바스크립트)

## 11-1. 타입 선언

- 타입 선언은 `.d.ts` 확장자를 가진 파일이며, **타입이 없는 자바스크립트 코드에 타입스크립트 타입을 부여할 수 있는 수단이다**
- 즉 타입 선언은 TS에게 "자바스크립트에는 이런저런 정보가 정의되어 있어!"라고 알려주는 수단이다

  ```
  💡 타입 선언 특징

  1. 타입만 포함할 수 있음. 값은 안됨.
    - 즉, 함수, 클래스, 객체, 가변 구현, 매개변수, 기본값 등을 사용할 수 없음

  2. 값을 정의할 수 없지만 declare 라는 키워드를 사용해 JS의 다른 어딘가에 값이 있다는 사실을 선언할 수 있음

  3. 소바자가 볼 수 있는 대상에만 타입을 선어할 수 있음
    - 노출되지 않은 타입/함수 안에 선언된 지역 변수의 타입은 포함할 수 없음
  ```

- 타입 선언 파일은 다음처럼 활용된다
  1. 사용자가 TS 응용 프로그램에서 여러분이 만든 TS를 사용한다면 그들의 TSC 인스턴스는 여러분의 타입스크립트로부터 생성된 자바스크립트 파일에 대응하는 `.d.ts` 파일을 검색한다 (결과적으로 Ts가 여러분의 프로젝트에 사용된 타입을 알 수 있다)
  2. 코드 편집기는 타입 선언 파일들을 읽어 해석한 다음, 유저가 코드를 작성할 때 유용한 타입 힌트를 제공한다 (TS가 코드가 아니더라도)
  3. TS 코드의 불필요한 재컴파일을 막아주어 컴파일 시간을 크게 줄여준다
- 타입 선언을 일반 선언과 구별하기 위해 타입 선언에 `ambient`라는 표현을 쓰기도 한다
- 타입 선언은 다음과 같은 상화에서 사용할 수 있다
  1. JS 어딘가에 전역 변수가 정의되어 있음을 TS에 알리기 위해 (예: 전역 Promise를 polyfill 하거나 브라우저 환경에 process.evn를 정의한 다음 앰비언트 변수 선언을 이용해 TS에 알림)
  2. 프로젝트 어디에서나 전역으로 이용할 수 있는 타입을 정의하여 임포트 없이 바로 사용하고자 할 때 (앰비언트 타입 선언)
  3. TS에 NPM으로 설치한 서드 파티 모듈이 있음을 알릴 때 (앰비언트 모듈 선언)
- 어떤 목적으로 사용하든지 타입 선언은 스크립트 모드의 `.ts.`나 `.d.ts` 파일 안에 위치해야 한다
  - 관례상 대응하는 `.js` 파일이 있으면 `.d.ts`, 그렇지 않으면 `.ts` 확장자를 사용한다
- 타입 선언 파일에 선언된 최상위 수준 '값'에는 `declare` 키워드를 사용해야 하지만(예: declare let, declare function, declare class 등), 최상위 수준 타입/인터페이스에는 사용하지 않아도 된다

### 11-1-1. 앰비언트 변수 선언

- 앰비언트 변수 선언: 한 프로젝트의 모든 `.ts`, `.d.ts` 파일에서 임포트 없이 사용할 수 있는 전역 변수의 존재를 타입스크립트에 알리는 수단이다

  ```TS
  // polyfill.ts

  // 1. window 확장을 위해 process라는 전역 객체의 형태를 정의하고 TS에 알린다
  declare let process: {
    env: {
      NODE_ENV: 'production' | 'development'
    }
  }

  // window 확장, window.process 만들어짐
  process = {
    env: {
      NODE_ENV: 'production'
    }
  }
  ```

### 11-1-2. 앰비언트 타입 선언

- 앰비언트 타입 선언은 앰비언트 변수 선언과 같은 규칙을 사용한다 (선언은 `.ts`나 `.d.ts` 파일에 저장해야 하며 명시적으로 임포트 하지 않아도 프로젝트의 모든 파일에서 전역으로 이용 가능)
- 응용 프로그램 전체에서 사용할 데이터 타입을 정의하고자 한다면 앰비언트 타입 선언이 좋다

  ```TS
  // types.ts
  type ToArray<T> = T extends unknown[] ? T : T[];

  // types.ts가 아닌 다른 파일
  function toArray<T>(a: T): ToArray<T> {
    // ...
  }
  ```

## 11-2. 자바스크립트를 타입스크립트로 천천히 마이그레이션 하기

### 11-2-1. 단계 1: TSC 추가

- TS와 JS가 함께 사용된 코드베이스에서는 TSC가 TS뿐 아니라 JS 파일도 컴파일하도록 설정해야 한다 (`tsconfig.json` 파일을 아래처럼 설정하면 됨)
  ```TS
  {
    "compilerOptions": {
      "allowJs": true,
      "checkJs": true // 선택사항: true면 자바스크립트 파일 컴파일할 때 타입스크립트 코드 다루듯 최선을 다해 타입을 추론하고 검증한다
    }
  }
  ```

### 11-2-3. 단계 2: JSDoc 어노테이션 추가 (선택사항)

- 급한 상황에서는 기존의 JS 파일에 새로 추가한 새 함수에만 타입 어노테이션을 추가하고 싶을 수도 있다
- 타입스크립트로 마이그레이션 하기 전까지는 JSDoc 어노테이션을 새 함수에 적용할 수 있음
  ```JS
  /**
   * @param word { string } 변환할 입력 문자열
   * @returns { string } 파스칼 표기법으로 변환된 문자열
   */
  export function toPascalCase(word) {
    return word.replace(
      /\w+/g,
      ([a, ...b]) => a.toUpperCase() + b.join('').toLowerCase()
    )
  }
  ```
- JSDoc이 없었다면 타입스크립트는 toPascalCase 함수의 타입을 `(word: any) => string`으로 추론했을 것이다. 하지만 JSDoc 덕분에 `(word: string) => string` 이라는 사실을 알 수 있게 된다

### 11-2-4. 단계 3: 파일 이름을 `.ts`로 바꾸기

- 이제 한 파일씩 확장자를 `.ts`로 변경하면 된다. 변경하면 모든 파일에 꼬불거리는 빨간줄이 생기게 된다 (TypeError들)
- 이를 참고해서 하나씩 고쳐가면 된다

### 11-2-5. 단계 4: 엄격하게 만들기

- JS의 주요 부분을 TS로 바꿨으면, TSC 엄격성과 관련된 플래그를 한 개씩 설정해가면서 코드를 최대한 안전하게 만들면 된다
- 마지막에는 TSC의 자바스크립트 상호 운용 플래그를 꺼서 모든 코드가 엄격한 타입의 타입스크립트가 되도록 강제한다
  ```Ts
  {
    "compilerOptions": {
      "allowsJs": false,
      "checkJs": false
    }
  }
  ```
- 이때 발생하는 에러까지 모두 해결하면 코드베이스는 아주 안전해졌다는 뜻이다

## 11-4. 서드 파티 자바스크립트 사용

- `npm install`로 서드 파티 JS 코드를 프로젝트에 설치할 때 다음 3가지 상황이 일어날 수 있다
  1. 코드를 설치할 때 타입 선언이 함께 제공됨
  2. 코드를 설치할 때 타입 선언은 제공되지 않지만 DefinitelyTyped에서 선언을 구할 수 있음
  3. 코드를 설치할 때 타입 선언이 제공되지 않으며 DefinitelyTyped에서도 구할 수 없음

### 11-4-1. 경우 1: 타입 선언을 포함하는 자바스크립트

- `{ "noImplicitAny": true }`를 설정하는 경우 import하면 패키지에 타입 선언이 함께 따라오며, 덕분에 TS는 꼬불거리는 빨간 밑줄을 보여주지 않는다
- 설치하는 코드가 TS로 컴파일되었거나, 저자가 친절하게도 NPM 패키지에 타입 선언을 포함시켜 놓았다면 코드를 설치하기만 하면 곧바로 타입 지원을 완벽히 받을 수 있다

### 11-4-2. 경우 2: DefinitelyTyped에서 타입 선언을 제공하는 자바스크립트

- 임포트하는 서드 파티 코드가 자체적으로 타입 선언을 포함하지 않더라도, 타입스크립트 커뮤니티를 관리하는 앰비언트 모듈 선언 중앙 저장소인 DefinitelyTyped에서 타입 선언을 제공하기도 한다
- 모든 DefinitelyTyped 타입 선언은 NPM의 @types 영역에 설치되므로 해당 영역에서 npm install을 실행해보면 된다

  ```
  npm install lodash --save (Lodash 설치)

  npm install @types/lodash --save-dev (Lodash의 타입 선언 설치)
  💡참고: --save-dev 플래그를 설정하면 설치한 타입 선언을 package.json의 devDependencies 필드에 추가해준다
  ```
